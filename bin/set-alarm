#!/usr/bin/env bash

SCRIPT=$(basename "${BASH_SOURCE[0]}")
function usage() {
  echo "$SCRIPT sets up an alarm later in time"
  echo "$SCRIPT [-number-of-beeps|-n <number of beeps>] [--message|-m <message>]  <time-spec>"
  echo "number-of-beeps: Number of times the computer should beep (and wake you up)"
}

beeps=5
while [ $# -gt 0 ]; do
  case "$1" in
    -n|--number-of-beeps)
      beeps=$2
      shift
      ;;
    -m|--message)
      message=$2
      shift
      ;;
    -h|--help)
      usage
      exit
      ;;
    *)
      break
      ;;
  esac
  shift
done


title="set-alarm notification"
if [ -z "${message}" ]; then
  message="Alarm set off"
fi

script=$(cat << EOF
${HOME}/bin/beep ${beeps} &
${HOME}/bin/notify "${title}" "${message}"
EOF
)

echo "${script}" | at "$@"
