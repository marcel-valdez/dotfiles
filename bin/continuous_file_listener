#!/usr/bin/env python

import os
import sys
import time
from subprocess import call

def validate_file(filename):
  if not os.path.isfile(filename):
    print "The file " + filename + " does not exist."
    exit(1)

  if not os.access(filename, os.R_OK):
    print "The file " + filename + " is not accessible."
    exit(1)

def get_modification_time(filename):
  return os.path.getmtime(filename)

def execute_command(command):
  try:
    call(command)
  except Exception, e:
    print "Error while executing command: " + ' '.join(map(str, command))
    print "Details: " + str(e)

def print_mod_message(filename, modtime):
  modtime_msg = time.strftime("%I:%M:%S %p", time.localtime(modtime))
  print "-- [" + modtime_msg + "] Change detected."

def main(filename, command):
  validate_file(filename)
  last_modification_time = get_modification_time(filename)
  while True:
    modtime = get_modification_time(filename)
    if last_modification_time != modtime:
      execute_command(command)
      last_modification_time = modtime
    time.sleep(0.5)

if __name__ == '__main__':
  script_name = sys.argv[0]
  if len(sys.argv) < 3:
    print "Usage: " + sys.argv[0] + " <filename> <command> <arg1> <arg2> ... <argN>"
    exit(1)

  filename = sys.argv[1]
  command = sys.argv[2:len(sys.argv)]

  main(filename, command)
